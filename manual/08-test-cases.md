
# 8. 動作確認項目（チェックリスト）

このドキュメントは、「小説らいたー」の各機能が意図通りに正しく動作することを確認するための、詳細なテスト項目をまとめたものです。機能改修や不具合修正を行った際に、これらの項目を確認することで、予期せぬ別の不具合（リグレッション）が発生していないかをチェックできます。

---

## 0. テストの準備：まっさらな状態から始める

完全に新規ユーザーの状態でテストを開始するために、ブラウザに保存されている過去のデータを削除します。

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **データのリセット** | 1. `F12`キーを押して、ブラウザの開発者ツールを開く<br>2. 「アプリケーション」(Application) タブを選択<br>3. 左側のメニューから「ストレージ」 > 「ローカルストレージ」(Local Storage) を選択<br>4. 表示されたドメイン（URL）を右クリックし、「クリア」(Clear) を選択<br>5. ページをリロードする | 1. プロジェクト選択画面が表示され、既存のプロジェクトが一つも表示されていない状態になる |

---

## 1. プロジェクトとチュートリアル

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **標準モードでプロジェクト作成** | 1. プロジェクト選択画面で「標準モード」を選択<br>2. 「物語のタイトル」に「デバッグ用プロジェクト」と入力<br>3. 「作成」ボタンをクリック | 1. メイン画面に遷移する<br>2. 「小説らいたーへようこそ！」というチュートリアルが自動で開始される |
| **初回チュートリアル** | 1. 「次へ」ボタンを順番にクリックしていく | 1. 各ステップで、説明に合致したUI要素がハイライトされる<br>2. ポップアップが画面外にはみ出さずに表示される<br>3. 最後のステップで「完了」ボタンを押すと、チュートリアルが終了しUIが操作可能になる |
| **チュートリアルの再表示防止** | 1. ページをリロードする<br>2. 左上の「← プロジェクト一覧へ」をクリックし、再度「デバッグ用プロジェクト」を開く | 1. どちらの操作でも、チュートリアルが再表示されないことを確認する |
| **シンプルモードへの切り替え** | 1. ヘッダーの「シンプルモードへ」ボタンをクリック | 1. 左パネルがキャラクターと世界観のみのシンプルな表示に切り替わる<br>2. 右パネルが非表示になる |
| **標準モードへの復帰** | 1. ヘッダーの「標準モードへ」ボタンをクリック | 1. UIが元の標準モードに戻る |

---

## 2. キャラクター設定モーダル（最重要テスト項目）

### 2.1 新規キャラクターをAIとゼロから作成する

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **AIアシスタントの起動** | 1. 左パネル「キャラクター」の横にある「+」ボタンをクリック<br>2. 開いたモーダルの右下にある「AIアシスタント」ボタンをクリック | 1. キャラクター設定モーダルが新規作成モードで開く<br>2. AIキャラクター生成アシスタントのモーダルが開く<br>3. チャット入力欄の下には「送信」ボタンが1つだけ表示されている（`create`モード） |
| **AIとの対話** | 1. AIへの指示入力欄に「**明るい性格の魔法使いの少女**」と入力し、「送信」ボタンを押す<br>2. AIからの質問（例：「名前はどうしますか？」）に対し、「**名前は『ルナ』で**」と返信する<br>3. さらに会話を続け、年齢や外見などを決めていく | 1. AIとの会話がスムーズに進む<br>2. 右側の「生成プレビュー」に、会話で決まった内容（名前：ルナ、など）がリアルタイムで追加・更新されていく |
| **フォームへの反映** | 1. キャラクター設定がある程度固まったら、右下の「**この内容を反映する**」ボタンをクリック | 1. AIアシスタントモーダルが閉じる<br>2. 元のキャラクター設定モーダルの各フォーム（名前、性格など）に、AIと決めた内容が自動で入力されている |
| **キャラクターの保存** | 1. フォームの内容を確認し、右下の「保存」ボタンをクリック | 1. モーダルが閉じる<br>2. 左パネルに「ルナ」のキャラクターカードが追加されている |

### 2.2 既存キャラクターの設定をAIと深掘りする（相談モード）

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **AIアシスタントの起動** | 1. 左パネルにある「ルナ」のカードの「編集」ボタンをクリック<br>2. 開いたモーダルの右下にある「AIアシスタント」ボタンをクリック | 1. キャラクター設定モーダルが編集モードで開く<br>2. AIアシスタントモーダルが開く<br>3. チャット入力欄の下に「`💡 相談する`」と「`⚙️ 設定に反映`」の2つのボタンが表示されている（`update`モード） |
| **アイデアの相談** | 1. 「**彼女の服装について、かわいいアイデアをいくつか出して**」と入力<br>2. 「`💡 相談する`」ボタンをクリック（または`Ctrl+Enter`） | 1. ユーザーのチャット吹き出しが**ライムグリーン**になる<br>2. AIが服装のアイデアをいくつか提案する（例：「星空のローブはどうでしょう？」など）<br>3. **【最重要】** 右側の「生成プレビュー」に表示されている既存のデータ（名前、性格など）は**一切変更されない**ことを確認する |
| **会話の継続** | 1. AIの提案に対し、「**もっと詳しく教えて**」などと入力し、再度「`💡 相談する`」で会話を続ける | 1. 引き続き会話のみが進み、プレビューのデータは変更されないことを確認する |

### 2.3 既存キャラクターの設定をAIで更新する（設定反映モード）

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **設定の追加** | 1. 上記の「相談モード」での会話後、「**秘密の設定として『実は王家の生き残り』を追加して**」と入力<br>2. 「`⚙️ 設定に反映`」ボタンをクリック（または`Alt+Enter`） | 1. ユーザーのチャット吹き出しが**インディゴブルー**になる<br>2. **【最重要】** 右側の「生成プレビュー」の「秘密」の項目に、「実は王家の生き残り」が追加される<br>3. 既存のデータ（名前、性格など）は保持されていることを確認する |
| **設定の変更** | 1. 「**年齢を17歳に変更して**」と入力し、「`⚙️ 設定に反映`」ボタンをクリック | 1. プレビューの「年齢」が「17歳」に更新される |
| **フォームへの反映** | 1. プレビューの内容に満足したら、「この内容を反映する」ボタンを押し、元のフォームに戻って「保存」する | 1. AIと更新した内容がすべてフォームに反映され、保存後、キャラクターカードの情報も更新される |

### 2.4 その他のキャラクター機能

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **未保存時の警告** | 1. ルナの編集モーダルで何か項目を変更する<br>2. 保存せずに「×」ボタンで閉じようとする | 1. 「編集中の内容を保存して閉じますか？」という確認ポップオーバーが表示され、「保存して閉じる」「保存せずに閉じる」「キャンセル」が選択できる |
| **AI立ち絵生成** | 1. ルナの編集モーダルを開き、「容姿特徴リスト」に「髪の色：金」「瞳の色：青」と入力<br>2. 「AIで立ち絵を生成」ボタンを押し、「簡易生成」で画像を生成<br>3. 生成された画像の1つをクリックし、「この画像で決定する」を押す | 1. 画像生成モーダルが開く<br>2. 生成された画像に特徴がおおむね反映されている<br>3. 決定後、キャラクター設定モーダルのプレビュー画像が選択したものに変わる |

---

## 3. 世界観・相関図・タイムライン（修正確認テスト）

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **相関図の複数関係削除** | 1. キャラクター「A」「B」を作成<br>2. 相関図で、「A→B（友好）」と「B→A（敵対）」の2つの関係を作成<br>3. 「関係を削除」モードで、AとBを順番にクリック<br>4. 表示された確認ダイアログで「キャンセル」を押す<br>5. 再度、AとBをクリックし、今度は「OK」を押す | 1. 確認ダイアログ「A と B の間にあるすべての関係（2件）を削除しますか？」が表示される<br>2. キャンセル後、関係が削除されていないことを確認する<br>3. OKを押した後、2つの関係が両方とも削除されることを確認する |
| **タイムラインの場所設定追加** | 1. 「タイムラインボードを開く」<br>2. 「+ 新規イベントを作成」を押す<br>3. 「発生場所」で「その他」を選択し、自由記入欄に「忘れられた図書館」と入力<br>4. 自由記入欄の横に表示された「+」ボタンをクリック<br>5. イベントを保存する | 1. 「+」ボタンが表示される<br>2. クリック後、左パネルの「世界観」に「忘れられた図書館」が自動で追加される<br>3. イベント編集フォームの「発生場所」ドロップダウンが、自動で「忘れられた図書館」に切り替わる |

---

## 4. その他の設定・管理機能

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **プロットボードモーダルの起動** | 1. 左パネルのプロットボード「すべて表示する」ボタンを押す | 1. エラーなくプロットボードモーダルが表示される |
| **ナレッジベースモーダルの起動** | 1. 左パネルのナレッジベース「すべて表示して検索」ボタンを押す | 1. エラーなくナレッジベース一覧モーダルが表示される |
| **ナレッジ：本文リンク** | 1. ナレッジ項目「古代遺跡」を作成<br>2. 本文編集で `[[古代遺跡]]` と入力して保存<br>3. 本文に表示された「古代遺跡」リンクをクリック | 1. 本文中の「古代遺跡」がハイパーリンクになる<br>2. クリックすると、「古代遺跡」のナレッジ編集モーダルが開く |
| **ナレッジ：長いタイトルの表示** | 1. ナレッジ項目で、非常に長い名前（例: `これは非常に長くてレイアウトを崩す可能性のあるナレッジ項目の名前です`）を作成 | 1. 左パネルのナレッジカードと、ナレッジ一覧モーダルの両方で、タイトルが省略（...）表示され、レイアウトが崩れない |

---

## 5. AIとの連携と本文生成

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **話者カラーと話者名表示** | 1. キャラクター「ルナ」のテーマカラーを水色に設定<br>2. AI設定で「セリフに話者カラーを適用」と「セリフの話者名表示」を両方ONにする<br>3. 執筆モードで「ルナに自己紹介させて」と指示 | 1. 本文に `ルナ「私の名前はルナです」` のようなテキストが生成される<br>2. `ルナ` という話者名が表示され、**「私の名前はルナです」の部分のみが**水色で表示される |
| **隠しコマンド（キャラクター追加）** | 1. 本文にまだキャラクターとして登録していない「カイト」という名前を登場させる<br>2. 相談モードで「カイトをキャラクターに追加して」と入力して送信 | 1. キャラクター設定モーダルが自動で開く<br>2. カイトの性格や容姿など、本文中の描写が設定項目に自動で入力されている |
| **Undo/Redo** | 1. 執筆モードで本文を生成する<br>2. 右パネルの「元に戻す」ボタンを押す<br>3. 右パネルの「やり直す」ボタンを押す | 1. 生成された本文と、対応するチャット履歴（ユーザーの指示とAIの応答）が削除される<br>2. 元に戻した操作が復元され、本文とチャット履歴が元通りになる |

---

## 6. 書き出し機能

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **HTML書き出し** | 1. ヘッダーの「.htmlで出力」ボタンを押す<br>2. 「登場人物一覧」でルナにチェックを入れる<br>3. ルナの横の「+」ボタンで、書き出し用の説明文「本作の主人公。」を入力して保存<br>4. 「この設定で書き出す」ボタンを押す | 1. `.html`ファイルがダウンロードされる<br>2. ブラウザで開くと、「登場人物」セクションにルナが表示され、説明文が「本作の主人公。」になっている |

---

## 7. 意地悪・カオスな操作（ストレステスト）

| テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- |
| **AIへの指示連打** | 1. 右パネルのAIへの指示入力欄に何か入力する<br>2. 送信ボタンをマウスで素早くダブルクリック（または `Ctrl+Enter` を連打）する | 1. AIへのリクエストは1回だけ送信され、ローディング中は送信ボタンが押せなくなる<br>2. AIからの返信が複数返ってくる、などの意図しない動作が起きない |
| **AIのタイムアウト** | 1. （開発者向け）`apiUtils.ts` の `API_TIMEOUT` を一時的に `1` に変更する<br>2. AIに何か指示を送る | 1. AIからの応答を待っている途中で、「AIの応答がタイムアウトしました。」というエラーメッセージがチャットに表示される |
| **巨大なテキストの貼り付け** | 1. Web上の非常に長い記事（例: Wikipediaの「日本」のページ全文など）をコピーする<br>2. 本文の段落を編集モードにし、コピーした全文を貼り付けて保存する | 1. アプリがクラッシュしたり、ブラウザが固まったりしない<br>2. 保存後、ページをリロードしても巨大なテキストが本文に正しく表示される |
| **絵文字・特殊文字の使用** | 1. 新規プロジェクト作成時に、タイトルに絵文字や記号をたくさん入力して作成する（例: `😈✨僕の最強小説（笑）‼✨🔥`）<br>2. キャラクター名にも同様に絵文字などを使ってみる | 1. プロジェクトが問題なく作成される<br>2. ヘッダーや各UIで、文字化けせずに絵文字や記号が正しく表示される |