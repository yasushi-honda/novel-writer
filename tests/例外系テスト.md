# 例外系・異常系テスト設計書

## 概要
このドキュメントは、「小説らいたー」が予期せぬ入力や状況に遭遇した際に、アプリケーションがクラッシュしたりデータを破損したりすることなく、安定して動作し続ける（堅牢性）ことを確認するためのテストケースを定義します。

## テスト目的
- 無効な入力や境界値に対して、アプリケーションが適切にハンドリングできることを保証する。
- 通信エラーやAPIエラー発生時に、ユーザーに分かりやすいフィードバックを返し、安全に復帰できることを確認する。
- ユーザーの意図しない連続操作などによって、UIやデータが不整合な状態に陥らないことを確認する。

## 前提条件
- テスト中は、ブラウザの開発者ツールを常に表示し、コンソールにエラーが出力されていないかを監視する。

---

## テスト項目一覧

| 機能分類 | テスト項目 |
| :--- | :--- |
| **入力検証** | 空文字、長すぎる文字列、特殊文字、絵文字の入力 |
| **操作フロー** | ボタンの連打、モーダル表示中の背後操作、編集中リロード |
| **データ管理** | 不正な形式のファイルインポート、巨大なデータの貼り付け |
| **API通信** | タイムアウト、APIキーエラー、ネットワーク切断 |
| **UI状態** | 複数ウィンドウの同時操作、急なブラウザリサイズ |

---

## 詳細テストケース

### 入力検証

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-EX-IN-001** | 必須項目への無入力 | 1. 新規プロジェクト作成時にタイトルを空にする<br>2. キャラクター作成時に名前を空にする | 1. 「作成」ボタンが無効化される<br>2. 「保存」ボタンを押しても保存されず、エラーメッセージが表示されるか入力欄がハイライトされる。 |
| **TC-EX-IN-002** | 長すぎる文字列 | 各入力欄（タイトル、名前、本文など）に非常に長い文字列（例：1万文字以上）をペーストして保存する | 1. UIが崩れない<br>2. アプリがクラッシュしない<br>3. 保存・再表示が正常に行える。 |
| **TC-EX-IN-003** | 特殊文字・絵文字 | プロジェクト名、キャラクター名、本文などに絵文字や`<>"`などの特殊文字を入力して保存する | 文字化けやUIの崩れ、機能不全が発生しない。特にHTMLエクスポート時にエスケープ処理がされているか確認。 |

### 操作フロー

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-EX-FLOW-001**| ボタン連打 | AIへの「送信」ボタンや各種「保存」ボタンを素早くダブルクリック（連打）する | リクエストが複数回送信されたり、データが二重に作成されたりせず、1回の操作として処理される。ローディング中はボタンが無効化される。 |
| **TC-EX-FLOW-002**| 編集中リロード | キャラクター編集モーダルを開き、内容を変更した直後にブラウザをリロードする | リロード後、プロジェクトを開き直すと、モーダルでの変更は保存されていない（元の状態である）。 |
| **TC-EX-FLOW-003**| モーダル表示中の裏画面操作| キャラクター編集モーダルを開いた状態で、背後にあるメイン画面のUIを（可能な限り）操作しようとする | 背後のUIは操作不能になっているか、操作してもモーダルの表示に影響を与えない。 |

### データ管理

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-EX-DATA-001**| 不正なJSONインポート | 1. JSONの構文が壊れているファイル（例：括弧が閉じていない）をインポート<br>2. JSON形式だが`Project`型と全く異なる構造のファイルをインポート | 1. 「ファイルの読み込みに失敗しました」というエラーが表示される<br>2. 同様にエラーが表示されるか、不足しているデータをデフォルト値で補完して読み込もうと試みる。アプリはクラッシュしない。 |
| **TC-EX-DATA-002**| 巨大なテキストの貼り付け| 本文編集エリアに数MBレベルの巨大なテキストを貼り付けて保存しようとする | ブラウザがフリーズしたり、アプリがクラッシュしたりしない。現実的な時間内に保存が完了する。（負荷テストも参照） |

### API通信

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-EX-API-001** | ネットワーク切断 | 1. ブラウザの開発者ツールでネットワークを「オフライン」に設定<br>2. AIに指示を送信する | 「ネットワークエラー」やそれに類するメッセージがチャット欄に表示され、ローディングが永久に続かない。 |
| **TC-EX-API-002** | APIタイムアウト | 1. 開発者ツールでネットワークを「低速3G」に設定<br>2. AIに長文生成を指示する | 設定されたタイムアウト時間（例: 120秒）を超過すると、「AIの応答がタイムアウトしました」というエラーメッセージが表示される。 |
| **TC-EX-API-003** | APIキー無効 | （もし可能なら）意図的に無効なAPIキーを設定してAIに指示を送信する | 「APIキーが無効です」というエラーメッセージが表示される。 |
| **TC-EX-API-004** | クォータ超過 | （もし可能なら）APIの利用上限に達した状態で指示を送信する | 「利用枠の上限に達しました」というエラーメッセージが表示される。 |

---
