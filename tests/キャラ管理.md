# キャラクター・世界観管理テスト設計書

## 概要
このドキュメントは、物語の根幹をなす「キャラクター」と「世界観」の設定管理機能に関するテストケースを定義します。手動でのCRUD（作成、読み取り、更新、削除）操作に加え、本アプリの核心機能であるAIアシスタントとの連携による設定生成・更新フローを重点的に検証します。

## テスト目的
- キャラクターと世界観の各種設定項目が、正しく保存・表示・更新できることを保証する。
- AIアシスタントとの対話を通じて、設定を直感的かつ正確に生成・更新できることを確認する。
- AIによる画像生成機能が、設定内容を反映した画像を生成できることを確認する。

## 前提条件
- テスト対象のプロジェクトがメイン画面で開かれていること。

---

## テスト項目一覧

| 機能分類 | テスト項目 |
| :--- | :--- |
| **キャラクター管理** | 新規作成、編集、削除、全項目入力 |
| **キャラクターAIアシスタント** | 新規作成フロー、既存データ更新フロー（相談/設定反映モード） |
| **AI立ち絵生成** | プロンプト生成、画像生成、画像適用 |
| **世界観管理** | 新規作成、編集、削除、カスタム項目、テンプレート適用 |
| **世界観AIアシスタント** | 新規作成フロー、既存データ更新フロー（相談/設定反映モード） |

---

## 詳細テストケース

### キャラクター管理

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-CHAR-001** | 新規キャラクター作成 (手動) | 1. 左パネルのキャラクター「＋」ボタンを押す<br>2. 名前、性格など必須・任意項目を入力し「保存」 | 1. 左パネルに新しいキャラクターカードが追加される<br>2. 再度編集モーダルを開くと、入力した内容が保持されている。 |
| **TC-CHAR-002** | キャラクター編集 | 1. 既存キャラクターの編集ボタンを押す<br>2. テーマカラーや容姿特徴リストなどを変更し「保存」 | 1. 変更内容が保存される<br>2. 左パネルのカードや相関図、本文のセリフカラーなどに変更が反映される。 |
| **TC-CHAR-003** | キャラクター削除 | 既存キャラクターのゴミ箱アイコンを押し、確認ダイアログで「OK」 | 左パネルからキャラクターカードが削除され、相関図からもノードが消える。 |
| **TC-CHAR-004** | 全項目入力テスト | 新規キャラクター作成時に、全てのタブの全ての入力項目（カスタム項目含む）に有効な値を入力して保存 | 全ての情報が正しく保存・表示されることを確認する。 |

### キャラクターAIアシスタント

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-CHAR-AI-001** | 新規作成フロー | 1. キャラクター新規作成モーダルから「AIアシスタント」を起動<br>2. 「クールな剣士」と入力し送信<br>3. AIの質問に答えながら設定を固める<br>4. 「この内容を反映する」→「保存」 | 1. AIとの対話内容がプレビューに反映される<br>2. 最終的にキャラクターが作成される。 |
| **TC-CHAR-AI-002** | 既存データ更新 (相談) | 1. 既存キャラの編集モーダルからAIアシスタントを起動<br>2. 「彼の過去について悲しいエピソードを考えて」と入力し、「相談する」で送信 | 1. AIがアイデアを提案する<br>2. **プレビューのデータは一切変更されない。** |
| **TC-CHAR-AI-003** | 既存データ更新 (設定反映) | 1. 既存キャラの編集モーダルからAIアシスタントを起動<br>2. 「秘密の設定に『実は王子』と追加して」と入力し、「設定に反映」で送信 | 1. プレビューの「秘密」の項目が更新される<br>2. 他のデータは保持されている。 |
| **TC-CHAR-AI-004** | モード切替とショートカット | 1. 既存キャラのAIアシスタントで、「相談する」(`Ctrl+Enter`)と「設定に反映」(`Alt+Enter`)を交互に使用する | 各モードに応じたAIの応答とプレビューの挙動が正しく切り替わる。 |

### AI立ち絵生成

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-CHAR-IMG-001** | 簡易生成 | 1. キャラクター編集モーダルで容姿特徴（髪の色：金、など）を入力<br>2. 「AIで立ち絵を生成」→「簡易生成」を実行 | 1. 画像生成が開始される<br>2. 生成された画像に、設定した特徴がおおむね反映されている。 |
| **TC-CHAR-IMG-002** | 詳細生成 (対話) | 1. 「AIで立ち絵を生成」→「詳細生成」に切り替え<br>2. AIと服装やポーズについて対話し、「以上で生成して」と指示 | 1. AIとの会話が進行する<br>2. 最終的な指示で画像生成が開始される。 |
| **TC-CHAR-IMG-003** | 画像の適用と修正 | 1. 生成された画像から1枚を選択<br>2. 「この画像で決定する」を押す<br>3. 再度モーダルを開き、生成画像を選択し、「修正案の入力」で修正指示を出して再生成 | 1. 選択した画像がキャラクター設定に適用される<br>2. 修正指示を反映した画像が再生成される。 |

### 世界観管理

| テストケースID | 対象機能 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- |
| **TC-WORLD-001** | 新規世界観作成 (手動) | 1. 左パネルの世界観「＋」ボタンを押す<br>2. 名前を入力し、「カスタム項目」を追加して保存 | 左パネルに新しい世界観カードが追加される。 |
| **TC-WORLD-002** | テンプレート適用 | 1. 世界観編集モーダルで「テンプレート」の「場所」ボタンを押す | 「種別」「所属地域」などの場所関連のカスタム項目が自動で追加される。 |
| **TC-WORLD-003** | AIアシスタント連携 | 1. 世界観編集モーダルから「AIアシスタント」を起動<br>2. AIと対話して設定を作成・更新する | キャラクターAIアシスタントと同様に、相談/設定反映モードで設定を構築できる。 |
| **TC-WORLD-004** | 地図・画像の登録 | 1. 「ビジュアル」タブで地図画像をアップロードし保存<br>2. 画像をクリックする | 1. 画像がプレビュー表示される<br>2. 画像が拡大表示されるモーダルが開く。 |

---
