# AIテスト設計書

## 概要
このドキュメントは、「小説らいたー」の核となるAIアシスタント機能に関するテストケースを定義します。AIの応答の質、各種設定（人格、文体、記憶範囲など）の反映、提案機能の精度、そしてAIとの対話フローの自然さなどを検証します。

## テスト目的
- AIが各種設定に基づいて、ユーザーの意図に沿った高品質な応答を生成できることを保証する。
- 相談モードと執筆モードで、AIの役割が明確に分離されていることを確認する。
- AIの提案機能が、物語の文脈に適した内容を適切なタイミングで提示できることを確認する。

## 前提条件
- テスト対象のプロジェクトがメイン画面で開かれていること。
- `test_world_sample.json`のデータをインポートした状態を基準とする。

---

## テスト項目一覧

| 機能分類 | テスト項目 |
| :--- | :--- |
| **AI人格（ペルソナ）** | 各人格設定（丁寧な編集者、親しい友人など）での応答テスト |
| **執筆スタイル** | 文体模倣ON/OFF、視点、トーン＆マナーの反映テスト |
| **セリフ生成** | 話者名表示、話者カラー適用の全組み合わせ（4パターン）での出力テスト |
| **コンテキスト参照** | 記憶範囲、ナレッジ参照強度、ピン留め機能の反映テスト |
| **提案機能** | ナレッジ/プロット提案の頻度と内容の妥当性テスト |
| **複数提案モード** | 提案される展開の多様性と品質テスト |
| **AIアシスタント（設定）**| キャラクター/世界観設定モーダル内でのAI対話フローテスト |

---

## 詳細テストケース

### AI人格（ペルソナ）反映テスト

| テストケースID | 対象機能 | 設定 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-AI-PER-001** | 丁寧な編集者 | ・口調: 丁寧な編集者<br>・モード: 相談 | 「このプロットどう思う？」と送信 | 「〜ですね」「〜はいかがでしょうか？」など、敬体（ですます調）で応答する。 |
| **TC-AI-PER-002** | 親しい友人 | ・口調: 親しい友人<br>・モード: 相談 | 「このプロットどう思う？」と送信 | 「〜だね！」「〜いいと思うよ！」など、カジュアルな口調（タメ口）で応答する。 |
| **TC-AI-PER-003** | 分析的な批評家 | ・口調: 分析的な批評家<br>・モード: 相談 | 「このプロットどう思う？」と送信 | 「論理的な矛盾があります」「伏線が不足しています」など、冷静かつ分析的な口調で応答する。 |
| **TC-AI-PER-004** | ユーザー名呼びかけ| ・ユーザーネーム: テストユーザー<br>・口調: 丁寧な編集者 | 「アイデアをください」と送信 | 応答の中に「テストユーザーさん、〜」のように、設定したユーザー名が含まれることがある。 |

### 執筆スタイル反映テスト

| テストケースID | 対象機能 | 設定 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-AI-WRI-001** | 文体模倣 (ON) | ・ユーザーの文体を模倣: ON<br>・モード: 執筆<br>・既存本文: 「彼は言った。静かに。」のような短文スタイル | 「そして彼は歩き出した」と送信 | 生成される本文が、既存の本文と同様の短い文体で構成される。 |
| **TC-AI-WRI-002** | 文体模倣 (OFF) | ・ユーザーの文体を模倣: OFF<br>・モード: 執筆<br>・既存本文: 短文スタイル | 「そして彼は歩き出した」と送信 | 生成される本文が、AI独自の（比較的描写の多い）文体になり、既存の文体に縛られない。 |
| **TC-AI-WRI-003** | 視点 (一人称) | ・文体・視点: 一人称<br>・モード: 執筆 | 「リリアが街を歩いているシーン」と送信 | 「私は街を歩いていた。」のように、主人公（リリア）の一人称視点で本文が生成される。 |
| **TC-AI-WRI-004** | トーン＆マナー | ・トーン＆マナー: コミカル, 皮肉を込めて<br>・モード: 執筆 | 「リリアとカインが言い合いをしているシーン」と送信 | 生成される本文が、コミカルで少し皮肉の効いた雰囲気の描写や会話になる。 |

### コンテキスト参照テスト

| テストケースID | 対象機能 | 設定 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-AI-CTX-001** | ナレッジ参照 (厳格) | ・ナレッジ参照強度: 厳格<br>・ナレッジ: 「月の加護」を登録済み<br>・モード: 執筆 | 「魔法が使えなくなったリリアのシーン」と送信 | 生成される本文に、「月の加護を失ったからだ」というような、ナレッジに基づいた理由付けが含まれる可能性が高い。 |
| **TC-AI-CTX-002** | ナレッジ参照 (柔軟) | ・ナレッジ参照強度: 柔軟<br>・ナレッジ: 「月の加護」を登録済み<br>・モード: 執筆 | 「月の加護と関係なく、リリアが新しい魔法に目覚めるシーン」と送信 | AIが既存のナレッジ設定を一部逸脱し、指示に沿った新しい展開を生成しようとする。 |
| **TC-AI-CTX-003** | ピン留めナレッジ | ・ナレッジ「古代遺跡」をピン留め<br>・モード: 執筆 | 「遺跡とは全く関係ない場所で、リリアがペンダントの力を使うシーン」と送信 | AIの応答（`replyText`）や本文（`newChunk`）の中で、「古代遺跡」との関連性に言及しようとする傾向が見られる。 |
| **TC-AI-CTX-004** | 記憶範囲 (現在のシーンのみ) | ・記憶範囲: 現在のシーンのみ<br>・モード: 執筆<br>・本文: 10章分の長い物語が存在する | 「第一章の出来事を踏まえて、リリアの心情を描写して」と送信 | AIが第一章の出来事を正確に思い出せず、直近の文脈に基づいた一般的な心情を描写する可能性が高い。 |
| **TC-AI-CTX-005** | 記憶範囲 (全文参照) | ・記憶範囲: 物語全体の文脈を参照<br>・モード: 執筆<br>・本文: 10章分の長い物語が存在する | 「第一章の出来事を踏まえて、リリアの心情を描写して」と送信 | AIが第一章の具体的な出来事を参照し、それに基づいた心情を描写できる。 |

### セリフ生成テスト

| テストケースID | 対象機能 | 設定 | 操作手順 | 期待結果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-AI-DLG-001** | 話者名:OFF / カラー:OFF | ・話者名表示: OFF<br>・話者カラー適用: OFF | 「リリアとカインの会話」を指示 | `「こんにちは」とリリアは言った。` のように、地の文と一体化した自然な会話文が生成される。 |
| **TC-AI-DLG-002** | 話者名:ON / カラー:OFF | ・話者名表示: ON<br>・話者カラー適用: OFF | 「リリアとカインの会話」を指示 | `リリア「こんにちは」` のように、話者名がセリフの前に付与された形式で生成される。 |
| **TC-AI-DLG-003** | 話者名:OFF / カラー:ON | ・話者名表示: OFF<br>・話者カラー適用: ON | 「リリアとカインの会話」を指示 | `<speaker name="リリア">「こんにちは」と彼女は微笑んだ。</speaker>` のように、`<speaker>`タグで囲まれ、地の文と一体化した自然な文章が生成される。 |
| **TC-AI-DLG-004** | 話者名:ON / カラー:ON | ・話者名表示: ON<br>・話者カラー適用: ON | 「リリアとカインの会話」を指示 | `<speaker name="リリア">リリア「こんにちは」</speaker>` のように、`<speaker>`タグで囲まれ、かつ話者名がセリフの前に付与された形式で生成される。 |

---
